<% if grid.not_ready_for_replies? %>
  <%= render 'shared/survey_no_questions', survey: grid.survey %>
<% elsif grid.no_data? %>
  <%= render 'shared/survey_no_replies', survey: grid.survey %>
<% else %>
  <%= render 'data_grid/tools', grid: grid %>
  <div class="data-grid mb-5 d-flex flex-column flex-grow vh-100">
    <vaadin-grid column-reordering-allowed>
      <% grid.questions.each do |question| %>
        <vaadin-grid-sort-column
          resizable
          auto-width
          header="<%= question.text %>"
          text-align="<%= question.type.dispatch(:get_text_alignment, context: self) %>"
          path="<%= question.id %>">
        </vaadin-grid-sort-column>
      <% end %>
      <span slot="empty-state">No data found.</span>
    </vaadin-grid>
    <script>
     const grid = document.querySelector('vaadin-grid');
     grid.size = <%= grid.record_count %>;
     grid.dataProvider = (params, callback) => {
       const { page, pageSize, sortOrders } = params;

       const url = new URL("<%= survey_data_url(grid.survey, format: :json) %>");
       url.searchParams.set('page', page);
       url.searchParams.set('items', pageSize);

       const ordering = sortOrders[0];
       if (ordering) {
         url.searchParams.set('sort_by', ordering.path)
         url.searchParams.set('sort_direction', ordering.direction);
       }

       fetch(url)
         .then((res) => res.json())
         .then((items) => callback(items.records));
     };
    </script>
  </div>
<% end %>
